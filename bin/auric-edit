#!/bin/zsh -e

cd ${MUSIC:-~/music}

typeset opt file=false
while getopts :f opt; do
    case $opt in
        (f) file=true ;;
    esac
done
typeset -a files
files=(
    $(
        for o in $@; do
            if $file; then
                if [[ $o == listen.* ]]; then
                    o=$o:h:h/metadata
                else
                    o=$o:h/metadata
                fi
                #while [[ $o != ./metadata && ! -e $o ]]; do
                #    o=$o:h:h/metadata
                #done
                [[ -e $o ]] || exit 2
                print $o
            else
                print $o/metadata
            fi
        done
    )
)
print -l FILES $files
vim -p $files
